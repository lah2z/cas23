{% extends "base.html" %}

{% block title %}Мои заказы{% endblock %}

{% block content %}
<div class="w-full max-w-2xl mx-auto px-2 sm:px-4">
    <!-- Шапка -->
    <div class="header bg-white p-4 flex items-center shadow-sm sticky top-0 z-10">
        <a href="/profile" class="mr-4">
            <i class="fas fa-chevron-left text-gray-600"></i>
        </a>
        <h1 class="text-lg font-semibold">Мои заказы</h1>
    </div>

    <!-- Основной контент -->
    <div class="p-4">


        <!-- Список заказов -->
        <div class="space-y-3">
            {% if orders and orders|length > 0 %}
                {% for order in orders %}
                <div class="order-card bg-white rounded-lg border border-gray-200 p-4">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-semibold">Заказ #{{ order.order_number or order.id }}</h3>
                            <p class="text-sm text-gray-500">{{ order.created_at.strftime('%d.%m.%Y, %H:%M') }}</p>
                            <p class="text-xs text-gray-400">Статус: {{ order.status }}</p>
                            <p class="text-xs text-gray-400">Оплата: {{ order.payment_method|default('—') }}</p>
                            <p class="text-xs text-gray-400">Доставка: {{ order.delivery_method|default('—') }}</p>
                            <p class="text-xs text-gray-400">Адрес: {{ order.address|default('—') }}</p>
                            <p class="text-xs text-gray-400">ФИО: {{ order.fio|default('—') }}</p>
                            <p class="text-xs text-gray-400">Телефон: {{ order.phone|default('—') }}</p>
                        </div>
                        <span class="status-{{ order.status|lower|replace(' ', '-') }} px-3 py-1 rounded-full text-xs font-medium" style="color: {% if order.status == 'Принят в работу' %}#22c55e{% elif order.status == 'Отменен' %}#ef4444{% else %}#6b7280{% endif %};">
                            {{ order.status }}
                        </span>
                    </div>
                    <div class="mb-2">
                        <b>Товары:</b>
                        <ul class="pl-4 list-disc">
                        {% for item in order.items %}
                            <li>
                                <span class="font-medium">{{ item.title }}</span>
                                × {{ item.quantity }}
                                <span class="text-gray-500 text-xs">({{ item.price|int }} ₽)</span>
                                {% if item.options %}
                                    <span class="text-xs text-gray-400">[{{ item.options|join(', ') }}]</span>
                                {% endif %}
                            </li>
                        {% endfor %}
                        </ul>
                    </div>
                    <div class="flex justify-between items-center pt-3 border-t border-gray-100">
                        <span class="font-semibold">Сумма: {{ order.total|int }} ₽</span>
                        <button class="text-gray-600 text-sm font-medium" onclick="window.location.href='/'">Повторить заказ</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center text-gray-400 py-8">У вас пока нет заказов</div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Установка цветов из WebApp (оставляем, если нужно)
        if (window.Telegram && window.Telegram.WebApp.themeParams) {
            document.documentElement.style.setProperty('--button-color', window.Telegram.WebApp.themeParams.button_color);
            document.documentElement.style.setProperty('--button-text-color', window.Telegram.WebApp.themeParams.button_text_color);
        }
        // Фильтрация заказов (визуально)
        const filterButtons = document.querySelectorAll('.flex.overflow-x-auto button');
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => {
                    btn.classList.remove('bg-blue-100', 'text-blue-800');
                    btn.classList.add('bg-gray-100', 'text-gray-800');
                });
                button.classList.remove('bg-gray-100', 'text-gray-800');
                button.classList.add('bg-blue-100', 'text-blue-800');
                // Здесь может быть логика фильтрации заказов по статусу
            });
        });
        if (filterButtons.length > 0) {
            filterButtons[0].click();
        }
    });
</script>
{% endblock %}

{% block styles %}
<style>
    .status-принят-в-работу {
        color: #22c55e;
    }
    .status-отправлен {
        color: #3b82f6;
    }
    .status-доставлен {
        color: #22c55e;
    }
    .status-отменен {
        color: #ef4444;
    }
</style>
{% endblock %} 